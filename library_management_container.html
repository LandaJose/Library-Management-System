<!DOCTYPE html>
<html>
  <head>
    <!-- <meta charset="UTF-8" /> -->
    <title>Library – Student Checkout</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #f4f4f7;
      }

      .app {
        display: flex;
        height: 100vh;
      }

      /* LEFT PANEL – student search */
      .sidebar {
        width: 35%;
        background: #fff;
        border-right: 1px solid #ddd;
        padding: 16px;
        box-sizing: border-box;
      }

      .sidebar h2 {
        margin-top: 0;
      }

      .search-box input {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        margin-bottom: 8px;
      }

      .student-list {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: calc(100vh - 140px);
        overflow-y: auto;
      }

      .student-list li {
        padding: 8px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
      }

      .student-list li:hover {
        background: #f0f0ff;
      }

      .student-list li.active {
        background: #dfe7ff;
        font-weight: bold;
      }

      /* RIGHT PANEL – details + scan */
      .main {
        flex: 1;
        padding: 16px 24px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }

      .header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .student-name {
        font-size: 1.3rem;
        font-weight: bold;
      }

      .mode-toggle button {
        padding: 6px 12px;
        border: 1px solid #888;
        background: #eee;
        cursor: pointer;
        margin-left: 4px;
      }

      .mode-toggle button.active {
        background: #4b6cff;
        color: #fff;
        border-color: #4b6cff;
      }

      .scan-section {
        background: #fff;
        padding: 12px 16px;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 16px;
      }

      .scan-section label {
        display: block;
        margin-bottom: 4px;
        font-weight: bold;
      }

      .scan-section input {
        width: 100%;
        padding: 10px;
        font-size: 1rem;
        box-sizing: border-box;
      }

      .status {
        margin-top: 8px;
        font-size: 0.95rem;
        min-height: 20px;
      }

      .status.ok {
        color: #0b7c21;
      }

      .status.error {
        color: #b00020;
      }

      .loan-list {
        background: #fff;
        padding: 12px 16px;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        flex: 1;
        overflow-y: auto;
      }

      .loan-list h3 {
        margin-top: 0;
      }

      .loan-list table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.95rem;
      }

      .loan-list th,
      .loan-list td {
        padding: 6px 4px;
        border-bottom: 1px solid #eee;
        text-align: left;
      }

      .loan-list th {
        font-weight: bold;
        background: #f9f9f9;
      }

      .hidden {
        display: none;
      }

      /* STYLING FOR BOOKS IN LIBRARY TABLE */

      .books-table {
        width: 100%;
        max-width: 800px;
        border-collapse: collapse; /* remove gaps between cells */
        margin-top: 10px;
        font-family: Arial, sans-serif;
      }

      /* header row – purple bar like your example */
      .books-table thead th {
        background-color: #4a6741;
        color: #ffffff;
        padding: 10px 12px;
        font-weight: bold;
        text-align: left;
        border: 1px solid #d0c4dd;
      }

      /* body cells */
      .books-table td {
        border: 1px solid #d0c4dd; /* grid lines (vertical + horizontal) */
        padding: 8px 12px;
        font-size: 14px;
      }

      /* zebra striping for rows */
      .books-table tbody tr:nth-child(even) {
        background-color: #f9f7fb;
      }

      /* hover effect (optional) */
      .books-table tbody tr:hover {
        background-color: #efe7fb;
      }

      /* align last column (Copy #) to center & narrow */
      .books-table td:last-child,
      .books-table th:last-child {
        text-align: center;
        width: 80px;
      }

      /* END OF STYLING FOR BOOKS IN TABLE */
    </style>
  </head>
  <body>
    <div class="app">
      <!-- RIGHT: Student details + scan -->
      <div class="main">
        <div class="header-row">
          <!-- <div class="student-name" id="studentName">Select a student…</div> -->
          <div class="mode-toggle">
            Mode:
            <!-- 
              <button id="addBooks" class="" onclick="addBooks()"> 
                Add Books
              </button>
            -->
            <button id="reviewBooks" class="" onclick="viewBooks()">
              Books
            </button>
            <button id="viewStudents" class="" onclick="viewStudents()">
              Students
            </button>
            <button id="checkOut" class="" onclick="checkOut()">
              Check-Out
            </button>
            <button id="checkIn" class="" onclick="checkIn()">Check-In</button>
            <button
              id="studentAccount"
              class=""
              onclick="viewStudentsAccount()"
            >
              Students Account
            </button>
          </div>
        </div>

        <!-- Add Book Section Start -->
        <!--
         <div id="addBooksSection" class="hidden">
          <label for="isbnInput">Scan Book ISBN</label>
          <input type="text" id="isbnInput" placeholder="Scan Book" />
        </div>
        -->
        <!-- Add Book Section End -->

        <!-- Check out Section Start -->
        <div id="checkOutSection" class="hidden">
          <label for="studentName">Student's Full Name</label>
          <input
            type="text"
            id="fullName"
            placeholder="Enter Students Full Name"
          />
          <label for="bookSelected">Scan Book</label>
          <input type="text" id="checkOutScanBook" placeholder="Scan Book" />
        </div>
        <!-- Check Out Section End -->

        <!-- Books Tab Start -->
        <div id="booksListSection" class="">
          <!--
            <label for="isbnInput">Scan Book to Add</label>
            <input type="text" id="isbnInput" placeholder="Scan Book" />
          -->
          <label for="isbnInput">Scan Book to Add</label>
          <input type="text" id="isbnInput" placeholder="Scan Book to Add" />

          <h3>Books in Library</h3>
          <label for="bookSearch">Book Search</label>
          <input
            type="text"
            id="searchBook"
            oninput="searchForBook(this.value)"
            placeholder="Search for a Book"
          />
          <table id="booksTable" class="books-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Author</th>
                <th>Copy #</th>
              </tr>
            </thead>
            <tbody>
              <!-- query stuff here by JS -->
            </tbody>
          </table>
        </div>
        <!-- Book Tab End -->

        <!-- Students Tab Start -->
        <div id="studentListSection" class="hidden">
          <label for="addStudent">Add Student</label>
          <input
            type="text"
            id="fullNameInput"
            placeholder="Enter Students Full Name"
          />
          <input
            type="text"
            id="periodInput"
            placeholder="Enter Students Period"
          />

          <button id="addStudent" onclick="addStudent()">Add Student</button>

          <h3>Students</h3>
          <input
            type="text"
            id="searchForStudent"
            oninput="searchForStudent(this.value)"
            placeholder="Search for a Student"
          />
          <table id="studentTable" class="books-table">
            <thead>
              <tr>
                <th>Full Name</th>
                <th>Period</th>
              </tr>
            </thead>
            <tbody>
              <!-- query stuff here by JS -->
            </tbody>
          </table>
        </div>
        <!-- Students Tab End -->

        <div id="loanListSection" class="hidden">
          <h3>Current Books</h3>
          <table>
            <thead>
              <tr>
                <th>Title</th>
                <th>ISBN</th>
              </tr>
            </thead>
            <tbody id="loanTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var isbnInput = document.getElementById("isbnInput");

        refreshBooksTable();

        if (!isbnInput) return;

        isbnInput.addEventListener("keydown", async function (e) {
          if (e.key === "Enter") {
            e.preventDefault();

            var isbn = this.value.trim();
            if (!isbn) return;

            console.log(isbn + " THIS BOOK WAS SCANNED");

            const info = await fetchBookInfoByIsbn(isbn);
            console.log(info);

            await saveBookToDB(isbn, info.title, info.author);

            this.value = ""; // clear for next scan
          }
        });
      });
      function addBooks() {
        //aclearActive();
        //document.getElementById("addBooks").classList.add("active");
        //document.getElementById("addBooksSection").classList.remove("hidden");
        var isbnInput = document.getElementById("isbnInput");
        if (isbnInput) {
          isbnInput.value = "";
          isbnInput.focus();
        }
      }

      async function saveBookToDB(isbn, title, author) {
        try {
          const result = await window.libraryAPI.addBook({
            isbn,
            title,
            author,
          });
          console.log("Book saved to DB:", result);
          await refreshBooksTable();
        } catch (err) {
          console.error("Failed to save book:", err);
        }
      }

      async function viewBooks() {
        clearActive();
        document.getElementById("reviewBooks").classList.add("active");
        document.getElementById("booksListSection").classList.remove("hidden");

        await refreshBooksTable();
      }

      async function refreshBooksTable() {
        // get all books from main process
        const books = await window.libraryAPI.listBooks();

        const tbody = document.querySelector("#booksTable tbody");
        if (!tbody) return;

        tbody.innerHTML = "";

        books.forEach((b) => {
          const tr = document.createElement("tr");

          const tdTitle = document.createElement("td");
          tdTitle.textContent = b.title;

          const tdAuthor = document.createElement("td");
          tdAuthor.textContent = b.author || "";

          const tdCopy = document.createElement("td");
          tdCopy.textContent = b.book_copy_number;

          tr.appendChild(tdTitle);
          tr.appendChild(tdAuthor);
          tr.appendChild(tdCopy);

          tbody.appendChild(tr);
        });
      }

      async function searchForBook(book_title) {
        // get all books from main process

        var searchBook = book_title.trim();
        if (!searchBook) refreshBooksTable();

        console.log(searchBook + " THIS BOOK WAS Searched");

        /* HAVE TO RUN SEARCH QUERY WHENEVER WE TYPE SOMETHING NOT SURE IF THIS IS GONNA BE TOO MUCH AND SHOULD JUST DO ONCLICK FOR A BUTTON */
        const books = await window.libraryAPI.searchForBook(book_title);

        const tbody = document.querySelector("#booksTable tbody");
        if (!tbody) return;

        tbody.innerHTML = "";

        books.forEach((b) => {
          const tr = document.createElement("tr");

          const tdTitle = document.createElement("td");
          tdTitle.textContent = b.title;

          const tdAuthor = document.createElement("td");
          tdAuthor.textContent = b.author || "";

          const tdCopy = document.createElement("td");
          tdCopy.textContent = b.book_copy_number;

          tr.appendChild(tdTitle);
          tr.appendChild(tdAuthor);
          tr.appendChild(tdCopy);

          tbody.appendChild(tr);
        });
      }

      function addBooks() {
        clearActive();
        //document.getElementById("addBooks").classList.add("active");
        //document.getElementById("addBooksSection").classList.remove("hidden");
        var isbnInput = document.getElementById("isbnInput");
        if (isbnInput) {
          isbnInput.value = "";
          isbnInput.focus();
        }
      }

      function checkOut() {
        clearActive();
        document.getElementById("checkOut").classList.add("active");
        document.getElementById("checkOutSection").classList.remove("hidden");
      }

      function checkIn() {
        clearActive();
        document.getElementById("checkIn").classList.add("active");
      }

      function clearActive() {
        document.querySelectorAll("button").forEach(function (btn) {
          btn.classList.remove("active");
        });
        //document.getElementById("addBooksSection").classList.add("hidden");
        document.getElementById("checkOutSection").classList.add("hidden");
        document.getElementById("booksListSection").classList.add("hidden");
        document.getElementById("studentListSection").classList.add("hidden");
      }

      async function fetchBookInfoByIsbn(isbn) {
        const res = await fetch(
          "https://www.googleapis.com/books/v1/volumes?q=isbn:" +
            encodeURIComponent(isbn)
        );

        const data = await res.json();

        if (!data.items || !data.items.length) {
          return null;
        }

        const volume = data.items[0].volumeInfo;

        return {
          title: volume.title || "Unknown title",
          author:
            (volume.authors && volume.authors.join(", ")) || "Unknown author",
        };
      }

      <!-- JS FOR VIEW STUDENT AND ADD STUDENT ETC-->

      async function viewStudents() {
        clearActive();
        document.getElementById("viewStudents").classList.add("active");
        document
          .getElementById("studentListSection")
          .classList.remove("hidden");
        await refreshStudentTable();
      }

      async function refreshStudentTable() {
        // get all books from main process
        const student = await window.libraryAPI.viewStudents();

        const tbody = document.querySelector("#studentTable tbody");
        if (!tbody) return;

        tbody.innerHTML = "";

        student.forEach((b) => {
          const tr = document.createElement("tr");

          const tdFullName = document.createElement("td");
          tdFullName.textContent = b.full_name;

          const tdPeriod = document.createElement("td");
          tdPeriod.textContent = b.period;

          tr.appendChild(tdFullName);
          tr.appendChild(tdPeriod);

          tbody.appendChild(tr);
        });
      }

      async function searchForStudent(studentName) {
        // get all books from main process

        var searchStudent = studentName.trim();
        if (!searchStudent) refreshStudentTable();

        console.log(searchStudent + " THIS Student WAS Searched");

        /* HAVE TO RUN SEARCH QUERY WHENEVER WE TYPE SOMETHING NOT SURE IF THIS IS GONNA BE TOO MUCH AND SHOULD JUST DO ONCLICK FOR A BUTTON */

        const student = await window.libraryAPI.searchForStudent(studentName);

        const tbody = document.querySelector("#studentTable tbody");
        if (!tbody) return;

        tbody.innerHTML = "";

        student.forEach((b) => {
          const tr = document.createElement("tr");

          const tdFullName = document.createElement("td");
          tdFullName.textContent = b.full_name;

          const tdPeriod = document.createElement("td");
          tdPeriod.textContent = b.period;

          const tdCopy = document.createElement("td");
          tdCopy.textContent = b.book_copy_number;

          tr.appendChild(tdFullName);
          tr.appendChild(tdPeriod);

          tbody.appendChild(tr);
        });
      }
    </script>
  </body>
</html>
